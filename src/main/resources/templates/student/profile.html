<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Profile</title>
    <link rel="stylesheet" th:href="@{/css/tailwind.css}">
</head>

<body class="bg-gray-100 min-h-screen">

<div th:replace="~{layout/header :: header}"></div>

<div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Student Profile</h1>

    <!-- Flash Messages -->
    <div th:if="${success}" class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4 rounded">
        <strong>✅ Success:</strong> <span th:text="${success}"></span>
    </div>

    <div th:if="${error}" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded">
        <strong>❌ Error:</strong> <span th:text="${error}"></span>
    </div>

    <div class="flex flex-col md:flex-row gap-6">

        <!-- ================= SIDEBAR ================= -->
        <aside class="md:w-1/3 bg-white rounded-2xl shadow-xl p-6 sticky top-6">
            <div class="flex flex-col items-center">

                <!-- Profile Image -->
                <img th:src="${user.userImage ?: 'https://image2url.com/r2/default/images/1766936428388-02d719cb-dd68-42e4-9d9e-77743ecb9589.png'}"
                     class="w-32 h-32 rounded-full border-4 shadow-lg object-cover mb-4"/>

                <p class="font-bold text-xl text-gray-800"
                   th:text="${user.firstName + ' ' + user.lastName}">Student Name</p>
                <p class="text-gray-500 mb-4" th:text="${user.email}">email@example.com</p>

                <!-- Upload Image -->
                <form th:action="@{/student/profile/upload-image}" method="post" enctype="multipart/form-data" class="w-full">
                    <label class="block text-center px-4 py-2 bg-gradient-to-r from-teal-400 to-cyan-500 text-white rounded-lg cursor-pointer">
                        Upload Image
                        <input type="file" name="image" accept="image/*" class="hidden" required>
                    </label>
                    <button type="submit"
                            class="mt-3 w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg">
                        Change Photo
                    </button>
                </form>
            </div>
        </aside>

        <!-- ================= MAIN CONTENT ================= -->
        <main class="md:w-2/3 space-y-6">

            <!-- ========= PROFILE FORM ========= -->
            <section class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-2">Personal Information</h2>

                <form th:action="@{/student/profile/update}"
                      th:object="${profile}"
                      method="post"
                      class="space-y-4">

                    <!-- First Name -->
                    <div>
                        <label class="block text-sm font-medium">First Name</label>
                        <input type="text" th:field="*{firstName}" required
                               class="w-full px-4 py-2 border rounded-md"/>
                        <p class="text-red-500 text-sm"
                           th:if="${#fields.hasErrors('firstName')}"
                           th:errors="*{firstName}"></p>
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label class="block text-sm font-medium">Last Name</label>
                        <input type="text" th:field="*{lastName}" required
                               class="w-full px-4 py-2 border rounded-md"/>
                        <p class="text-red-500 text-sm"
                           th:if="${#fields.hasErrors('lastName')}"
                           th:errors="*{lastName}"></p>
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium">Email</label>
                        <input type="email" th:field="*{email}" required
                               class="w-full px-4 py-2 border rounded-md"/>
                        <p class="text-red-500 text-sm"
                           th:if="${#fields.hasErrors('email')}"
                           th:errors="*{email}"></p>
                    </div>

                    <!-- DOB -->
                    <div>
                        <label class="block text-sm font-medium">Date of Birth</label>
                        <input type="date" th:field="*{dob}"
                               class="w-full px-4 py-2 border rounded-md"/>
                        <p class="text-red-500 text-sm"
                           th:if="${#fields.hasErrors('dob')}"
                           th:errors="*{dob}"></p>
                    </div>

                    <button type="submit"
                            class="w-full bg-teal-500 hover:bg-teal-600 text-white py-3 rounded-lg font-semibold">
                        Save Changes
                    </button>
                </form>
            </section>

            <!-- ========= ENROLLED COURSES ========= -->
            <section class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-2">My Enrolled Courses</h2>

                <div th:if="${#lists.isEmpty(enrolledCourses)}" class="text-gray-500 text-center">
                    You haven't enrolled in any courses yet.
                </div>

                <div th:each="enrollment : ${enrolledCourses}"
                     class="flex justify-between items-center bg-blue-50 p-4 rounded-lg mb-3">

                    <div>
                        <p class="font-semibold" th:text="${enrollment.courseName}"></p>
                        <p class="text-sm text-gray-500"
                           th:text="${#temporals.format(enrollment.enrollmentDate,'dd/MM/yyyy')}"></p>
                    </div>

                    <form th:action="@{/student/profile/drop-enrollment}" method="post"
                          onsubmit="return confirmDrop();">
                        <input type="hidden" name="enrollmentId" th:value="${enrollment.id}">
                        <button type="submit"
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Drop
                        </button>
                    </form>
                </div>
            </section>

        </main>
    </div>
</div>

<div th:replace="~{layout/footer :: footer}"></div>

<script>
function confirmDrop() {
    return confirm("Are you sure you want to drop this course?");
}
</script>

</body>
</html>
